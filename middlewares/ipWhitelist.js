const { Logger } = require("../config/require.config");

const whitelist = [
  "36.50.54.43",
  "203.94.90.186", 
  "35.72.7.66", 
  "103.67.199.65", 
  "103.75.182.31", 
  "45.133.168.240", 
  "20.78.39.38", 
  "49.0.113.137", 
  "42.96.44.107", 
  "74.226.200.0", 
  "49.0.113.130", 
  "101.99.29.204", 
  "123.231.72.213", 
  "183.81.33.248", 
  "175.100.116.25", 
  "203.144.79.56", 
  "49.231.234.140", 
  "103.126.161.94", 
  "113.61.34.250", 
  "35.73.74.88", 
  "160.191.88.139", 
  "103.63.123.98", 
  "123.231.72.214", 
  "54.178.23.33", 
  "203.94.90.189", 
  "103.75.180.76", 
  "103.188.244.216", 
  "36.50.54.59", 
  "103.67.198.123", 
  "203.205.57.205", 
  "1.54.249.144", 
  "42.96.45.214", 
  "36.50.54.40", 
  "103.172.79.45", 
  "210.245.30.171", 
  "103.173.226.130", 
  "160.191.49.130", 
  "20.243.146.71", 
  "103.69.84.142", 
  "103.188.167.155", 
  "49.231.234.139", 
  "18.163.178.154", 
  "144.48.229.33", 
  "103.67.198.95", 
  "60.251.156.172", 
  "203.205.17.50", 
  "103.63.123.171", 
  "203.95.43.4", 
  "103.65.235.247", 
  "154.212.161.30", 
  "103.209.34.234", 
  "139.162.77.229", 
  "103.63.123.173", 
  "49.236.210.208", 
  "202.183.210.152", 
  "113.61.34.230", 
  "14.225.211.56", 
  " 103.63.123.98", 
  "123.231.72.212", 
  "103.65.235.211", 
  "14.225.211.44", 
  "103.195.239.7", 
  "42.96.45.113", 
  "45.64.124.93", 
  "42.96.47.33", 
  "103.171.91.26", 
  "103.115.173.242", 
  "42.96.46.139", 
  "103.188.244.42", 
  "103.174.8.43", 
  "203.205.57.202", 
  "103.172.79.82", 
  "18.180.52.109", 
  "52.192.18.134", 
  "160.191.49.167", 
  "35.76.146.249", 
  "36.50.54.47", 
  "45.133.168.221", 
  "103.188.244.170", 
  "210.245.30.172", 
  "103.106.105.211", 
  "144.48.25.206", 
  "103.169.35.198", 
  "36.50.176.236", 
  "139.162.67.23", 
  "103.106.105.219", 
  "103.69.84.158", 
  "202.183.210.138", 
  "103.209.35.29", 
  "42.96.44.102", 
  "113.61.36.106", 
  "103.65.234.11", 
  "163.53.198.108", 
  "113.61.34.229", 
  "2405:4802:80fb:1db0:ad03:2ed1:3e2a:fcb3", 
  "103.118.28.155", "103.118.28.160", 
  "171.244.60.218", 
  "18.182.246.77", "218.211.60.8", " 103.209.34.254", "45.122.251.170", "103.69.84.135", "144.48.25.249", "20.249.19.84", "139.162.99.167", "113.61.34.13", "42.96.54.132", "123.231.72.210", "36.50.54.60", "101.99.29.205", "139.162.125.85", "147.139.202", "54.150.31.81", "103.195.239.8", "14.225.205.13", "202.57.209.111", "139.162.74.114", "148.109.32.178", "144.48.25.199", "203.205.59.110", "43.206.207.155", "183.81.33.237", "103.209.34.250", "52.194.88.19", "103.65.234.133", "42.96.46.69", "103.200.20.124", "113.61.34.233", "163.53.198.227", "14.225.211.205", "124.43.227.19", "103.67.199.148", "103.98.149.171", "203.205.17.17", "160.191.48.58", "38.252.150.15", "202.158.244.58", "103.173.226.110", " 49.236.210.170", "202.57.209.106", "42.96.47.4", "42.96.54.128", "103.1.29.109", "203.144.74.210", "103.195.238.63", "103.106.105.217", "42.96.45.58", "202.62.59.82", "202.57.209.103", "183.81.33.240", "203.170.179.35", "163.53.198.230", "103.65.234.116", "103.106.105.220", "103.67.198.130", "154.222.5.105", "103.174.8.45", "38.252.150.17", "54.238.82.247", "14.225.205.53", "103.1.29.110", "113.61.34.43", "49.236.210.102", "202.62.105.170", "103.29.70.232", "36.50.54.52", "203.205.57.204", "18.178.141.228", "103.63.123.82", "103.195.238.74", "103.209.34.201", "103.173.226.122", "20.89.66.247", "1.54.193.5", "175.100.116.21", "193.186.4.157", "1.1", "103.188.244.210", "103.195.238.56", "14.225.192.203", "103.195.239.10", "57.180.217.73", "103.118.28.174", "20.200.208.55", "42.96.44.173", "160.191.49.247", "148.109.33.226", "36.50.54.41", "113.61.38.94", "45.133.168.222", "203.205.17.2", "103.73.164.151", "103.67.198.59", "203.205.17.40", "175.100.116.7", "103.65.234.39", "36.50.54.61", "20.41.113.35", "202.57.209.115", "203.205.57.200", "123.231.72.211", "10.10.1.246", "136.228.143.30", "18.178.80.78", "103.20.96.192", "103.65.234.36", "147.139.177.47", "183.81.33.221", " 175.100.116.99  ", "103.65.234.55", "14.225.210.48", "38.252.150.7", "203.205.59.107", "160.191.48.62", "103.73.164.144", "14.225.205.242", "45.122.251.166", "38.252.150.6", "144.48.25.253", "210.245.30.175", "103.69.84.155", "163.53.198.226", "103.126.161.62", "128.1.119.2", "38.54.15.86", "::1", "103.171.91.167", "8.219.204.84", "122.146.88.8", "14.225.210.172", "160.191.48.131", "8.219.3.117", "203.94.90.190", "36.50.54.56", "103.169.35.176", "139.162.118.109", "18.178.21.30", "42.96.44.134", "42.96.47.54", "36.50.54.54", "139.162.108.177", "103.195.238.117", "103.188.244.243", "103.106.105.214", "13.113.17.140", "103.173.226.109", "42.96.47.172", "171.63.123.171", "113.61.35.177", "1.54.195.19", "167.179.13.104", "42.96.45.236", "103.200.20.188", "96.9.85.116", "183.81.33.210", "103.209.35.128", "8.218.78.217", "103.69.84.140", "128.1.214.226", "103.67.198.93", "45.250.238.162", "144.48.229.34", "144.48.25.214", "113.61.34.4", "103.118.28.166", "103.118.45.212", "103.63.123.172", "103.63.123.168", "18.182.162.94", "103.65.234.229", "103.67.198.119", "103.188.244.66", "144.48.25.254", "103.195.238.69", "58.187.190.229", "144.48.27.77", "14.225.210.50", "103.67.198.77", "103.90.150.189", "1.54.194.96", "36.50.54.44", "103.14.249.9", "144.48.25.215", "139.162.69.20", "202.57.209.105", "103.65.235.51", "103.209.34.43", "103.69.84.138", "101.99.29.202", "203.94.90.188", "172.104.106.240", "102.165.58.168", "42.96.46.63", "103.88.119.34", "202.93.153.233", "103.118.28.161", "14.225.210.47", "128.1.214.194", "210.245.30.173", "103.195.238.47", "2405:4802:811e:e070:6c82:987b:7c56:2465", "154.205.5.248", "42.96.44.212", "60.251.151.229", "18.136.133.67", "160.187.147.59", "163.53.198.231", "1.54.249.146", "14.225.204.239", "103.67.198.166", "175.100.116.17", "103.73.165.156", "183.81.33.220", "36.50.54.42", "139.162.72.110", "103.174.8.42", "103.169.35.181", "202.183.210.161", "42.96.46.142", "115.84.103.107", "38.252.150.8", "103.65.234.54", "103.209.34.40", "144.48.229.37", "14.225.205.102", "111.90.176.108", "20.48.61.65", "59.153.218.142", "115.84.103.106", "113.61.34.142", "103.67.199.17", "103.65.235.53", "49.0.113.14", "18.178.178.74", "45.122.251.167", "103.118.28.172", "36.50.54.45", "183.81.33.223", "144.48.25.202", "52.193.123.252", "49.0.113.140", "160.30.45.233", "129.227.187.66", "144.48.229.38", "203.205.59.109", "103.69.84.134", "14.225.207.55", "203.144.86.66", "14.225.205.1", "103.73.165.156 ", "52.68.170.111", "103.67.199.52", "42.96.47.126", "147.139.202.210", "103.118.28.153", "103.209.34.167", "42.96.47.60", "103.69.84.131", "14.225.206.124", "103.195.238.112", "139.162.123.235", "14.225.204.203", "103.63.123.169", "103.67.198.94", "36.50.54.62", "202.183.210.96", "54.250.174.246", "183.81.33.219", "202.183.210.153", "103.65.234.127", "203.205.59.108", "103.173.254.23", "144.48.25.217", "103.187.3.157", "163.53.198.229", "128.1.214.220", "47.237.242.82", "183.81.33.246", "1.54.249.147", "102.165.58.158", "144.48.229.18", "38.54.93.193", "103.67.198.142", "103.209.34.207", "103.118.28.191", "36.50.54.68", "192.168.1.253", "36.50.54.55", "45.122.251.171", "139.162.87.238", "42.96.54.45", "203.205.13.166", "160.191.49.214", "103.73.165.115", "61.6.47.57", "38.252.150.16", "139.162.89.139", "172.104.66.223", "20.196.194.127", "42.96.47.194", "96.9.95.114", "27.109.115.141", "52.220.169.213", "2001:4860:7:412::1", "202.62.105.172", "103.195.238.252", "45.133.168.216", "103.90.227.4", "103.65.234.13", "103.65.234.203", "18.179.230.174", "103.20.96.168", "203.94.90.185", "203.170.253.34", "103.209.35.28", "103.187.3.102", "171.244.39.135", "103.172.79.120", "103.188.244.31", "103.69.84.139", "103.90.227.173", "103.65.234.107", "175.100.116.99", "103.188.244.49", "42.96.46.131", "101.99.29.196", "42.96.44.135", "103.209.34.125", "139.162.85.32", "103.65.234.35", "103.174.8.44", "103.65.234.141", "103.67.198.101", "45.250.238.161", "103.106.105.213", "36.50.54.58", "42.96.54.39", "136.228.143.17", "103.172.79.221", "103.14.249.28", "49.236.210.170", "14.225.210.40", "203.205.59.106", "172.104.112.176", "139.162.126.8", "14.225.210.88", "113.61.34.226", "113.61.34.46", "103.195.238.251", "27.96.86.123", "103.188.244.70", "202.183.210.160", "103.1.29.106", "139.162.72.235", "13.112.117.0", "103.188.244.174", "20.78.2.208", "171.244.143.215", "14.225.210.91", "42.96.46.19", "36.50.54.48", "144.48.229.39", "103.63.123.170", "103.118.45.217", "54.178.52.150", "103.65.234.37", "14.225.198.149", "139.162.78.106", "103.90.227.214", "203.205.11.166", "160.30.45.219", "172.207.42.136", "122.146.89.64", "103.195.239.6", "203.94.90.191", "220.128.103.10", "103.172.79.98", "113.61.34.249", "103.75.182.30", "202.57.209.113", "183.81.33.238", "136.228.148.47", "156.59.131.18", "103.1.29.107", "103.65.235.56", "203.205.11.165", "203.170.253.35", "139.162.116.37", "101.99.29.203", "124.248.178.13", "42.96.54.129", "115.84.103.108", "203.94.90.184", "210.245.30.170", "45.250.238.163", "203.94.90.187", "103.143.207.112", "103.65.234.41", "103.171.91.148", "42.96.47.120", "167.179.13.105", "103.209.34.228", "113.61.34.228", "103.65.234.33", "203.205.17.16", "103.73.165.114", "18.167.129.155", "35.76.169.125", "103.65.234.51", "1.54.249.145", "45.250.238.162 ", "145.133.168.221", "42.96.47.58", "144.48.25.216", "144.48.25.209", "144.48.25.204", " 45.133.168.245", "52.193.69.112", "42.96.44.42", "103.75.182.6", "14.225.207.191", "210.245.30.174", "119.95.0.119", "129.227.235.130", "https://103.63.123.173", "144.48.25.198", "42.96.46.121", "113.61.34.42", "103.90.227.207", "160.191.49.169", "42.96.44.178", "14.225.205.54", "144.48.25.203", "42.96.54.131", "113.61.34.234", "103.67.198.102", "103.65.234.93", "42.96.44.193", "103.169.35.184", "36.50.54.63", "42.96.54.130", "103.195.239.9", "103.209.34.208", "103.166.184.117", "103.65.235.175", "103.69.84.137", "101.99.29.199", "103.188.244.124", "103.171.91.236", "103.67.198.149", "103.75.180.79", "172.104.98.91", "144.48.25.205", "172.105.242.157", "35.72.97.39", "45.64.124.110", "136.228.148.39", "13.113.73.147", "103.65.234.10", "192.168.9.242", "103.14.249.30", "172.16.12.119", "42.96.51.166", "103.29.68.248", "103.118.28.165", "103.1.29.108"
];

module.exports = (req, res, next) => {
  const rawIP = req.ip || req.connection.remoteAddress;
  const cleanIP = rawIP.replace('::ffff:', '');
  
  Logger.log(0, `===============================`, __filename);
  Logger.log(0, `rawIP:${rawIP}`, __filename);  
  Logger.log(0, `req.connection.remoteAddress:${req.connection.remoteAddress}`, __filename);   
  Logger.log(0, `cleanIP:${cleanIP}`, __filename);     
  Logger.log(0, `===============================`, __filename);

  if (whitelist.includes(cleanIP)) {
    return next();
  }
  
  return res.status(403).json({
    valid: false,
    status: 403,
    title: 'Forbiden',
    message: 'Bạn chưa được cấp quyền để truy cập, vui lòng liên hệ quản trị viên để được cấp phép!',
    yourIP: cleanIP,
    file: __filename
  });
};